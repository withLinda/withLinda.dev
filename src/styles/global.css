/* Tailwind CSS v4 Imports */
@import 'tailwindcss';

@plugin '@tailwindcss/typography';

/* Theme System - Modular Organization */
@import './themes/_base.css';
@import './themes/everforest-base.css';
@import './themes/everforest-light.css';
@import './themes/everforest-dark.css';

/* Theme Components - Clean Everforest Implementation */
@import './themes/body-backgrounds.css';
@import './themes/layout-backgrounds.css';
@import './themes/post-cards.css';

/* Syntax Highlighting - Shiki Overrides */
@import './themes/shiki-overrides.css';

/* Component Styles - Orb Animations */
@import './components/glassmorphism.css';


/* ==========================================
   TYPOGRAPHY & PROSE UTILITIES
   ========================================== */

@utility prose {
  /* CRITICAL: Override prose plugin's max-width */
  max-width: none !important;
  width: 100%;
  
  @apply leading-normal;
  @apply text-everforest-fg dark:text-everforest-fg;

  /* Consistent color application */
  & p {
    @apply text-everforest-text dark:text-everforest-text;
  }

  & li {
    @apply text-everforest-text dark:text-everforest-text;
  }

  & td {
    @apply text-everforest-text dark:text-everforest-text;
  }

  & h1 {
    @apply text-4xl font-bold my-8;
    @apply text-everforest-fg dark:text-everforest-yellow;
  }

  & h2 {
    @apply text-3xl font-semibold my-6;
    @apply text-everforest-fg dark:text-everforest-yellow;
  }

  & h3 {
    @apply text-2xl font-semibold my-4;
    @apply text-everforest-fg dark:text-everforest-yellow;
  }

  & h4 {
    @apply text-xl font-semibold my-4;
    @apply text-everforest-fg dark:text-everforest-yellow;
  }

  & p {
    @apply my-6;
    @apply text-everforest-text dark:text-everforest-text;
  }

  /* Fix for bold text in dark mode */
  & strong {
    @apply font-bold text-everforest-fg dark:text-everforest-fg;
  }

  & b {
    @apply font-bold text-everforest-fg dark:text-everforest-fg;
  }

  /* Emphasis/italic text */
  & em {
    @apply italic text-everforest-text dark:text-everforest-text;
  }

  & i {
    @apply italic text-everforest-text dark:text-everforest-text;
  }

  /* Inline code */
  & code:not(pre code) {
    @apply px-1.5 py-0.5 rounded-sm text-sm;
    /* Use same background as code blocks for consistency */
    background-color: var(--everforest-bg1) !important;
    border: 1px solid var(--everforest-bg3);
    @apply text-everforest-red dark:text-everforest-red;
  }

  /* Blockquotes with red accent border */
  & blockquote {
    @apply pl-4 my-6 italic text-everforest-text dark:text-everforest-text;
    border-left: 4px solid var(--everforest-red);
  }

  /* Images */
  & img {
    @apply rounded-lg shadow-lg my-8 w-full object-cover max-h-[600px];
  }

  & img + em {
    @apply block text-center text-sm text-everforest-text dark:text-everforest-text -mt-6 mb-8;
  }

  /* Links with red hover accent */
  & a {
    @apply text-everforest-blue dark:text-everforest-blue;
    text-decoration: underline;
    text-underline-offset: 2px;
    transition: color 0.2s ease;
  }

  & a:hover {
    color: var(--everforest-red);
  }

  /* Code blocks */
  & pre {
    @apply relative p-4 my-6 overflow-x-auto rounded-lg;
    /* Use authentic Everforest bg1 (#343F44) for code blocks */
    background-color: var(--everforest-bg1) !important;
    border: 1px solid var(--everforest-bg3);
    @apply text-everforest-text dark:text-everforest-text;
  }

  & pre code {
    @apply block p-0 overflow-visible bg-transparent border-0;
    @apply text-sm font-mono;
  }

  /* Enhanced Tables with red accents */
  & table {
    @apply w-full my-6 border-collapse rounded-lg overflow-hidden;
    border: 1px solid var(--everforest-border);
  }

  & thead {
    /* Subtle red gradient background */
    background: linear-gradient(135deg, 
      var(--everforest-bg-red) 0%, 
      var(--everforest-bg1) 100%);
  }

  & th {
    @apply p-3 text-left font-semibold;
    border-bottom: 2px solid var(--everforest-red);
    color: var(--everforest-fg);
  }

  /* Alternating row colors for better readability */
  & tbody tr:nth-child(even) {
    background-color: var(--everforest-bg1);
  }

  /* Hover effect for table rows */
  & tbody tr:hover {
    background-color: var(--everforest-bg2);
    transition: background-color 0.2s ease;
  }

  & td {
    @apply p-3;
    border-bottom: 1px solid var(--everforest-border-subtle);
    color: var(--everforest-fg);
  }

  /* Remove border from last row */
  & tbody tr:last-child td {
    border-bottom: none;
  }

  /* Horizontal rule with red gradient */
  & hr {
    @apply my-8;
    border: none;
    height: 2px;
    background: linear-gradient(90deg, 
      transparent 0%,
      var(--everforest-red) 50%,
      transparent 100%);
  }

  /* Unordered lists */
  & ul {
    @apply my-6 list-disc pl-8;
    @apply text-everforest-text dark:text-everforest-text;
  }

  /* Ordered lists */
  & ol {
    @apply my-6 list-decimal pl-8;
    @apply text-everforest-text dark:text-everforest-text;
  }

  /* All list items (both ul and ol) */
  & li {
    @apply my-2;
    @apply text-everforest-text dark:text-everforest-text;
  }

  /* Bold text within list items - explicit fix for the issue */
  & li strong {
    @apply text-everforest-fg dark:text-everforest-fg;
  }

  & li b {
    @apply text-everforest-fg dark:text-everforest-fg;
  }

  /* Nested paragraphs inside list items */
  & li p {
    @apply my-0;
  }

  /* List markers with red accent colors */
  & li::marker {
    color: var(--everforest-red);
  }
  
  .dark & li::marker {
    color: var(--everforest-red);
  }
}

/* ==========================================
   LAYOUT & NAVIGATION UTILITIES
   ========================================== */

@utility category {
  /* Category heading specific styling */
  & h2 {
    margin-left: 0;
  }
}

@utility inline-flex {
  /* Mobile-first approach for nav items */
  header nav & {
    margin-right: 0;
  }

  @media (min-width: 768px) {
    header nav & {
      margin-right: 27px;
    }
  }
}

/* ==========================================
   BASE STYLES & LAYOUT
   ========================================== */

@layer base {
  body {
    @apply dark:bg-everforest-bg text-everforest-fg dark:text-everforest-fg;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
    -webkit-font-smoothing: antialiased;
    text-rendering: optimizeLegibility;
    overflow-wrap: break-word;
  }
}

@layer components {
  /* Header navigation styling */
  header nav h2 {
    margin-left: 17px;
  }

  /* Desktop navigation spacing */
  header nav > div:last-child {
    margin-left: auto;
  }

  /* Copy Code Button Styles */
  .code-block-wrapper {
    @apply relative;
  }

  .copy-code-button {
    @apply absolute top-2 right-2 p-2 rounded-md;
    @apply bg-everforest-button hover:bg-everforest-active;
    @apply border border-everforest-border;
    @apply text-everforest-fg dark:text-everforest-fg;
    @apply opacity-75 hover:opacity-100;
    @apply transition-all duration-200;
    @apply flex items-center justify-center;
    @apply w-8 h-8;
  }

  .copy-code-button:focus {
    @apply outline-none ring-2 ring-everforest-accent;
    ring-color: rgb(from var(--color-everforest-accent) r g b / 0.5);
  }

  .copy-button-container {
    @apply absolute top-0 right-0;
  }
}

@layer utilities {
  /* Theme flash prevention */
  html.no-flash {
    visibility: hidden;
  }
}

/* Global aesthetic tweaks */
@layer base {
  html { scroll-behavior: smooth; }
  body {
    min-height: 100svh;
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
}

/* Typography balance & measure */
@layer components {
  .prose { max-width: 70ch; }
  .prose :where(p, ul, ol, blockquote) { line-height: 1.7; }
  .prose :where(h1){ letter-spacing: -0.02em }
  .prose :where(a){
    text-decoration-line: underline;
    text-decoration-thickness: from-font;
    text-underline-offset: 3px;
    text-decoration-color: transparent;
    transition: color .2s ease, text-decoration-color .2s ease;
  }
  .prose :where(a:hover){ text-decoration-color: currentColor; }
}

/* Selection */
@layer utilities {
  ::selection {
    background: color-mix(in oklab, var(--everforest-yellow) 22%, transparent);
  }
}
